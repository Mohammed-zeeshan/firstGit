<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration form</title>
    <style>
        form {
            border: 1px;
            padding: 5px;
            width: 400px;
            border-radius: 10px;
            opacity: 10;
            background-color: blue;
        }
        div {
            padding: 5px;
            display: grid;
            place-items: center;
        }
        input {
            padding: 5px;
            border-radius: 10px;
            border: 1px;
            background-color: lightblue;
        }
        body {
            background-color: lightgray;
        }
    </style>
</head>
<body>
    <div class="body">
        <form action="#" id="addForm" onsubmit="submitform(event)">
            <div><label for="username">Name :</label>
            <input type="text" name="username" id="username" placeholder="Enter name" required><br></div>
            <div><label for="email">Email :</label>
            <input type="email" name="email" id="email" placeholder="Enter email" required><br></div>
            <div><label for="password">Password :</label>
            <input type="password" name="password" id="password" placeholder="Enter password" required><br></div>
            <div><input class="btn" type="submit" value="Submit"></div>
        </form>
        <ul id="items"></ul>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js"></script>
    </div>
    <script>
        function submitform(event) {
            event.preventDefault();
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            let myObj = {
                'username': username,
                'email': email,
                'password': password
            }

            axios.post("https://crudcrud.com/api/b77c4cab466f4f4cba4ce9c5f7ac0275/appoinmentData",myObj)
                .then((response) => {
                    addItem(myObj);
                    console.log(response)
                })
                .catch((err) => {
                    console.log(err)
                })
            // let obj = JSON.stringify(myObj);
            // localStorage.setItem(email,obj)
            // let objects = JSON.parse(obj)
            // console.log(objects);
        }
        window.addEventListener("DOMContentLoaded",() => {
            axios.get("https://crudcrud.com/api/b77c4cab466f4f4cba4ce9c5f7ac0275/appoinmentData")
            .then((response) => {
                console.log(response)
                for (var i=0;i<response.data.length;i++){
                    addItem(response.data[i]);
                }
            })
            .catch((err) => {
                console.log(err)
            })
        })

        function addItem(myObj){

            let parentElem = document.getElementById('items')
            let li = document.createElement('li');
            li.className = 'list-group-item';
            li.appendChild(document.createTextNode(myObj.username));
            li.appendChild(document.createTextNode(' - '));
            li.appendChild(document.createTextNode(myObj.email));
            li.appendChild(document.createTextNode(' - '));
            li.appendChild(document.createTextNode(myObj.password));
            li.appendChild(document.createTextNode(' '));
            let deleteButton = document.createElement('input');
            deleteButton.type = "button";
            deleteButton.value = "delete";
            deleteButton.onclick = () => {
                // localStorage.removeItem(myObj.email)
                parentElem.removeChild(li)
            }
            axios.delete(`https://crudcrud.com/api/b77c4cab466f4f4cba4ce9c5f7ac0275/appoinmentData/${myObj._id}`)
                .then((response) => {
                    // console.log(response)
                    parentElem.removeChild(li)
                })
                .catch((err) => {
                    console.log(err)
                })
            let editButton = document.createElement('input');
            editButton.type = 'button';
            editButton.value = 'Edit';
            editButton.onclick = () => {
                localStorage.removeItem(myObj.amount)
                parentElem.removeChild(li);
                document.getElementById("username").value = myObj.amount;
                document.getElementById("email").value = myObj.description;
                document.getElementById("password").value = myObj.category;
            }
            li.appendChild(deleteButton);
            li.appendChild(document.createTextNode(' '));
            li.appendChild(editButton);
            parentElem.appendChild(li);
        }
    </script>
</body>
</html>
